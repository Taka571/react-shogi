{"version":3,"sources":["setting.tsx","pieces/piece.tsx","pieces/pawn.tsx","pieces/lance.tsx","pieces/knight.tsx","pieces/silver.tsx","pieces/gold.tsx","pieces/bishop.tsx","pieces/rook.tsx","pieces/king.tsx","pieces/mt.tsx","board.tsx","material/confirm.tsx","material/alert.tsx","game.tsx","index.tsx"],"names":["Setting","LENGTH","UNCLICKED","WHITE","MT","PIECES","NUM","Piece","_out","_turn","_piece_num","this","Pawn","Lance","Knight","Silver","Gold","Bishop","Rook","King","Mt","Square","props","class_string","is_captured","is_black","is_final","is_clicked","can_control","className","onClick","value","Board","i","j","x","Math","floor","y","key","squares","out","turn","content","control_piece","push","renderSquare","final_piece","clicked_piece","items","Array","concat","React","Component","Captured","num","Confirm","Dialog","disableBackdropClick","disableEscapeKeyDown","open","aria-labelledby","aria-describedby","DialogTitle","id","title","DialogContent","DialogContentText","message","DialogActions","Button","handleYes","color","handleNo","Alert","onClose","handleClose","style","whiteSpace","make_board","sfen","set_piece","n","piece","set_pieces","fill","set_control_piece","flag","control_pos_sub","control_pos","pos","kingx","kingy","check_king","piece_num","dx","dy","length","xx","yy","check","captured","def_controls","atc_controls","cnt","atc","atcx","atcy","abs","cur_pos","_","cloneDeep","can_move","nifu","mate","bfr_pos","Game","state","start_pos","start_black_piece","start_white_piece","current_pos","current_black_piece","current_white_piece","kifu","moves","moves_sub","black_name","white_name","moved_piece","promotion","resign","result","handlePromotion","bind","handleResign","handleResultClose","tmp_pos","tmp_control_piece","setState","tmp_black_piece","tmp_white_piece","is_promoted","promote","setTimeout","alert","tmp_control_pos","game","legend","handleClick","variant","rotate","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.dff86eb3.chunk.js","sourcesContent":["export class Setting{\r\n  // 盤の列数（行数）\r\n  public static LENGTH: number = 9;\r\n  public static UNCLICKED: number = 81 + 14;\r\n  public static WHITE: number = 7;\r\n  public static MT: number = 16;\r\n  public static PIECES: string[] = [\"飛\", \"角\", \"金\", \"銀\", \"桂\", \"香\", \"歩\", \"玉\", \"竜\", \"馬\", \"\", \"全\", \"圭\", \"杏\", \"と\", \"\"];\r\n  public static NUM: string[] = [\"\", \"\", \"ニ\", \"三\", \"四\", \"五\", \"六\", \"七\", \"八\", \"九\", \"十\", \"十一\", \"十二\", \"十三\", \"十四\", \"十五\", \"十六\", \"十七\", \"十八\"];\r\n}\r\n","import { Setting } from \"../setting\";\r\n\r\nexport abstract class Piece{\r\n  // 出力する文字\r\n  private _out: string;\r\n  // 先手の駒か\r\n  private _turn: boolean;\r\n  // 駒番号\r\n  private _piece_num: number;\r\n\r\n  constructor(_out: string, _turn: boolean, _piece_num: number){\r\n    this._out = _out;\r\n    this._turn = _turn;\r\n    this._piece_num = _piece_num;\r\n  }\r\n\r\n  public out(): string{\r\n    return this._out;\r\n  }\r\n  public turn(): boolean{\r\n    return this._turn;\r\n  }\r\n  public piece_num(): number{\r\n    return this._piece_num;\r\n  }\r\n  public promote(): void{\r\n    this._piece_num += Setting.MT / 2;\r\n    this._out = Setting.PIECES[this._piece_num];\r\n  }\r\n\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Pawn extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=6){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Lance extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=5){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Knight extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=4){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Silver extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=3){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Gold extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=2){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Bishop extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=1){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class Rook extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=0){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Setting} from '../setting';\r\nimport {Piece} from './piece';\r\n\r\nexport class King extends Piece{\r\n  constructor(_turn: boolean, _piece_num: number=7){\r\n    super(Setting.PIECES[_piece_num], _turn, _piece_num);\r\n  }\r\n}\r\n","import {Piece} from './piece';\r\n\r\nexport class Mt extends Piece{\r\n  constructor(_turn: boolean=true, _piece_num: number=16){\r\n    super(' ', _turn, _piece_num);\r\n  }\r\n}\r\n","import React from 'react';\r\n// import ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport {Setting} from \"./setting\";\r\nimport {Piece} from './pieces/piece';\r\n// import { Pawn } from \"./pieces/pawn\";\r\n// import { Mt } from \"./pieces/mt\";\r\n// import {Game} from './game';\r\n\r\ninterface ISquareProps{\r\n  is_final: boolean;\r\n  is_clicked: boolean;\r\n  value: string;\r\n  is_black: boolean;\r\n  is_captured: boolean;\r\n  can_control: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nfunction Square(props: ISquareProps){\r\n  let class_string: string = \"\";\r\n  if(props.is_captured){\r\n    class_string = \"captured\";\r\n  }\r\n  else{\r\n    class_string = \"square piece\";\r\n    if(!props.is_black){\r\n      class_string = class_string + \" white\";\r\n    }\r\n  }\r\n  if(props.is_final){\r\n    class_string = class_string + \" final\";\r\n  }\r\n  if(props.is_clicked){\r\n    class_string = class_string + \" click\";\r\n  }\r\n  if(props.can_control){\r\n    class_string = class_string + \" attack\";\r\n  }\r\n  return (\r\n    <button\r\n      className={class_string}\r\n      onClick={props.onClick}\r\n    >\r\n      {props.value}\r\n    </button>\r\n  );\r\n}\r\n\r\ninterface IBoardProps {\r\n  squares: Piece[][];\r\n  onClick: (i: number) => void;\r\n  clicked_piece: number;\r\n  control_piece: boolean[][];\r\n  final_piece: number;\r\n}\r\n\r\ninterface IBoardState {\r\n  squares: Piece[][];\r\n  onClick: (i: number) => void;\r\n  clicked_piece: number;\r\n  control_piece: boolean[][];\r\n  final_piece: number;\r\n}\r\n\r\nexport class Board extends React.Component<IBoardProps, IBoardState> {\r\n\r\n  renderSquare(is_final: boolean, is_clicked: boolean, can_control: boolean, i: number) {\r\n    let j = i - Setting.WHITE * 2;\r\n    let x: number = Math.floor(j / Setting.LENGTH);\r\n    let y: number = j % Setting.LENGTH;\r\n    return (\r\n      <Square\r\n        key={i}\r\n        is_final={is_final}\r\n        is_clicked={is_clicked}\r\n        value={this.props.squares[x][y].out()}\r\n        is_black={this.props.squares[x][y].turn()}\r\n        is_captured={false}\r\n        can_control={can_control}\r\n        onClick={() => this.props.onClick(i)}\r\n      />\r\n    );\r\n  }\r\n\r\n  content(y: number){\r\n    let content = [];\r\n    for(let x = Setting.LENGTH - 1; x >= 0; --x){\r\n      if(this.props.control_piece[x][y]){\r\n        content.push(this.renderSquare(false, false, true, x * Setting.LENGTH + y + Setting.WHITE * 2));\r\n      }\r\n      else if(x * Setting.LENGTH + y === this.props.final_piece - Setting.WHITE * 2){\r\n        content.push(this.renderSquare(true, false, false, x * Setting.LENGTH + y + Setting.WHITE * 2));\r\n      }\r\n      else if(x * Setting.LENGTH + y === this.props.clicked_piece - Setting.WHITE * 2){\r\n        content.push(this.renderSquare(false, true, false, x * Setting.LENGTH + y + Setting.WHITE * 2));\r\n      }\r\n      else{\r\n        content.push(this.renderSquare(false, false, false, x * Setting.LENGTH + y + Setting.WHITE * 2));\r\n      }\r\n    }\r\n    return content;\r\n  }\r\n\r\n  render() {\r\n    let items = new Array<JSX.Element>();\r\n    for(let y = 0; y < Setting.LENGTH; ++y){\r\n      items = items.concat(<div className=\"board-row ley\" key={y}>{this.content(y)}</div>);\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        {/* <div className=\"status\">{status}</div> */}\r\n        {items}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\ninterface ICapturedProps {\r\n  squares: number[];\r\n  clicked_piece: number;\r\n  is_black: boolean;\r\n  turn: boolean;\r\n  onClick: (i: number) => void;\r\n}\r\n\r\ninterface ICapturedState {\r\n  squares: number[];\r\n  clicked_piece: number;\r\n  is_black: boolean;\r\n  turn: boolean;\r\n  onClick: (i: number) => void;\r\n}\r\n\r\nexport class Captured extends React.Component<ICapturedProps, ICapturedState> {\r\n\r\n  renderSquare(is_clicked: boolean, i: number) {\r\n    return (\r\n      <Square\r\n        key={i}\r\n        is_final={false}\r\n        is_clicked={is_clicked}\r\n        value={Setting.PIECES[i]}\r\n        is_black={this.props.is_black}\r\n        is_captured={true}\r\n        can_control={false}\r\n        onClick={(this.props.is_black ? () => this.props.onClick(i) : () => this.props.onClick(i + Setting.WHITE))}\r\n      />\r\n    );\r\n  }\r\n\r\n  render() {\r\n    let items = new Array<JSX.Element>();\r\n    const clicked_piece: number = (this.props.turn ? this.props.clicked_piece : this.props.clicked_piece - Setting.WHITE);\r\n    const is_black: boolean = this.props.is_black;\r\n    const turn: boolean = this.props.turn;\r\n    for(let i = 0; i < Setting.WHITE; ++i){\r\n      let num = this.props.squares[i];\r\n      if(num > 0){\r\n        if(i === clicked_piece && is_black === turn){\r\n          items = items.concat(<div className=\"board-row ley\" key={i}>{this.renderSquare(true, i)}</div>);\r\n        }\r\n        else{\r\n          items = items.concat(<div className=\"board-row ley\" key={i}>{this.renderSquare(false, i)}</div>);\r\n        }\r\n        if(num > 1){\r\n          items = items.concat(<div className=\"board-row ley\" key={\"num\"+i}>{\r\n            <button\r\n              className={\"number\"}\r\n            >\r\n            {Setting.NUM[num]}\r\n            </button>\r\n          }</div>);\r\n        }\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        {items}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\n\r\ninterface IConfirmProps{\r\n  title: string;\r\n  message: string;\r\n  open: boolean;\r\n  handleYes: () => void;\r\n  handleNo: () => void;\r\n}\r\n\r\nexport default function Confirm(props: IConfirmProps) {\r\n  return (\r\n    <div>\r\n      {/* <Button variant=\"outlined\" color=\"primary\" onClick={handleClickOpen}>\r\n        Open alert dialog\r\n      </Button> */}\r\n      <Dialog\r\n        disableBackdropClick\r\n        disableEscapeKeyDown\r\n        open={props.open}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\">{props.title}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\">\r\n            {props.message}\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={props.handleYes} color=\"primary\">\r\n            はい\r\n          </Button>\r\n          <Button onClick={props.handleNo} color=\"primary\">\r\n            いいえ\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\n\r\ninterface IConfirmProps{\r\n  title: string;\r\n  message: string;\r\n  open: boolean;\r\n  handleClose: () => void;\r\n}\r\n\r\nexport default function Alert(props: IConfirmProps) {\r\n\r\n  return (\r\n    <div>\r\n      <Dialog\r\n        open={props.open}\r\n        onClose={props.handleClose}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\">{props.title}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\" style={{whiteSpace: 'pre-line'}}>\r\n            {props.message}\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={props.handleClose} color=\"primary\">\r\n            OK\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport './index.css';\r\nimport {Setting} from \"./setting\";\r\nimport {Piece} from './pieces/piece';\r\nimport { Pawn } from \"./pieces/pawn\";\r\nimport { Lance } from \"./pieces/lance\";\r\nimport { Knight } from \"./pieces/knight\";\r\nimport { Silver } from \"./pieces/silver\";\r\nimport { Gold } from \"./pieces/gold\";\r\nimport { Bishop } from \"./pieces/bishop\";\r\nimport { Rook } from \"./pieces/rook\";\r\nimport { King } from \"./pieces/king\";\r\nimport { Mt } from \"./pieces/mt\";\r\nimport {Board, Captured} from './board';\r\nimport _ from 'lodash';\r\nimport Confirm from './material/confirm'\r\nimport Alert from './material/alert'\r\nimport Button from '@material-ui/core/Button';\r\n\r\nexport function make_board(sfen=\"lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1\", language='Ja'): Piece[][]{\r\n  let squares: Piece[][] = [];\r\n  for(let i = 0; i < Setting.LENGTH; ++i){\r\n    squares[i] = [];\r\n    for(let j = 0; j < Setting.LENGTH; ++j){\r\n      squares[i].push(new Mt());\r\n    }\r\n  }\r\n  if(sfen === \"lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1\"){\r\n    for(let i = 0; i < Setting.LENGTH; ++i){\r\n      squares[i][2] = new Pawn(false);\r\n      squares[i][6] = new Pawn(true);\r\n    }\r\n    squares[0][0] = new Lance(false);\r\n    squares[8][0] = new Lance(false);\r\n    squares[0][8] = new Lance(true);\r\n    squares[8][8] = new Lance(true);\r\n\r\n    squares[1][0] = new Knight(false);\r\n    squares[7][0] = new Knight(false);\r\n    squares[1][8] = new Knight(true);\r\n    squares[7][8] = new Knight(true);\r\n\r\n    squares[2][0] = new Silver(false);\r\n    squares[6][0] = new Silver(false);\r\n    squares[2][8] = new Silver(true);\r\n    squares[6][8] = new Silver(true);\r\n\r\n    squares[3][0] = new Gold(false);\r\n    squares[5][0] = new Gold(false);\r\n    squares[3][8] = new Gold(true);\r\n    squares[5][8] = new Gold(true);\r\n\r\n    squares[1][1] = new Bishop(false);\r\n    squares[7][7] = new Bishop(true);\r\n\r\n    squares[7][1] = new Rook(false);\r\n    squares[1][7] = new Rook(true);\r\n\r\n    squares[4][0] = new King(false);\r\n    squares[4][8] = new King(true);\r\n  }\r\n  else{\r\n\r\n  }\r\n  return squares;\r\n}\r\n\r\nexport function set_piece(n: number, is_black: boolean): Piece{\r\n  let piece: Piece = new Mt();\r\n  if(n === 0) piece = new Rook(is_black);\r\n  if(n === 1) piece = new Bishop(is_black);\r\n  if(n === 2) piece = new Gold(is_black);\r\n  if(n === 3) piece = new Silver(is_black);\r\n  if(n === 4) piece = new Knight(is_black);\r\n  if(n === 5) piece = new Lance(is_black);\r\n  if(n === 6) piece = new Pawn(is_black);\r\n  return piece;\r\n}\r\n\r\nexport function set_pieces(): number[]{\r\n  let numbers: number[] = new Array<number>(Setting.WHITE).fill(0);\r\n  return numbers;\r\n}\r\n\r\nexport function set_kifu(): Array<string>{\r\n  let kifu: Array<string> = [];\r\n  return kifu;\r\n}\r\n\r\nexport function set_control_piece(flag: boolean = false): boolean[][]{\r\n  let control_piece: boolean[][] = [];\r\n  for(let i = 0; i < Setting.LENGTH; ++i){\r\n    control_piece[i] = new Array<boolean>(Setting.LENGTH).fill(flag);\r\n  }\r\n  return control_piece;\r\n}\r\n\r\n// ある駒の利きを列挙\r\n// 手番の駒のマスは移動するときにはじいているため、ここではそのマスも利きに入れてしまう\r\n// ただし飛び道具はすり抜けしないために正しい効きを列挙する\r\nfunction control_pos_sub(control_pos: number[][], pos: Piece[][], turn: boolean, x: number, y: number, kingx: number = -1, kingy: number = -1, check_king: boolean = true): void{\r\n  let num: number = pos[x][y].piece_num();\r\n  // 歩\r\n  if(num === 6){\r\n    if(turn ? y !== 0 : y !== Setting.LENGTH - 1){\r\n      let yy = (turn ? y - 1 : y + 1);\r\n      ++control_pos[x][yy];\r\n      // 王手をしているか\r\n      if(x === kingx && yy === kingy){\r\n        control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n        control_pos[Setting.LENGTH][1] = num;\r\n      }\r\n    }\r\n    return;\r\n  }\r\n  if(num === 2 || num === 3 || num === 4 || num === 7 || (11 <= num && num <= 14)){\r\n    let dx: number[];\r\n    let dy: number[];\r\n    // 桂\r\n    if(num === 4){\r\n      dx = new Array<number>(-1, 1);\r\n      dy = new Array<number>(-2, -2);\r\n    }\r\n    // 銀\r\n    else if(num === 3){\r\n      dx = new Array<number>(-1, 0, 1, 1, -1);\r\n      dy = new Array<number>(-1, -1, -1, 1, 1);\r\n    }\r\n    // 金、と、杏、圭、全\r\n    else if(num === 2 || (11 <= num && num <= 14)){\r\n      dx = new Array<number>(-1, 0, 1, 1, 0, -1);\r\n      dy = new Array<number>(-1, -1, -1, 0, 1, 0);\r\n    }\r\n    // 玉\r\n    else{\r\n      if(check_king){\r\n        dx = new Array<number>(-1, 0, 1, 1, 1, 0, -1, -1);\r\n        dy = new Array<number>(-1, -1, -1, 0, 1, 1, 1, 0);\r\n      }\r\n      else{\r\n        dx = new Array<number>(0);\r\n        dy = new Array<number>(0);\r\n      }\r\n    }\r\n    for(let i = 0; i< dx.length; ++i){\r\n      let xx = (turn ? x + dx[i] : x - dx[i]);\r\n      let yy = (turn ? y + dy[i] : y - dy[i]);\r\n      if(0 <= xx && xx < Setting.LENGTH && 0 <= yy && yy < Setting.LENGTH){\r\n        ++control_pos[xx][yy];\r\n        // 王手をしているか\r\n        if(xx === kingx && yy === kingy){\r\n          control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n          control_pos[Setting.LENGTH][1] = num;\r\n        }\r\n      }\r\n    }\r\n    return;\r\n  }\r\n  // 香\r\n  if(num === 5){\r\n    let dy: number = -1;\r\n    let yy = (turn ? y + dy : y - dy);\r\n    while(0 <= yy && yy < Setting.LENGTH){\r\n      ++control_pos[x][yy];\r\n      // 王手をしているか\r\n      if(x === kingx && yy === kingy){\r\n        control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n        control_pos[Setting.LENGTH][1] = num;\r\n      }\r\n      // 空きマスでなければ終わり\r\n      // ただし相手玉なら終わらない\r\n      if(pos[x][yy].piece_num() !== Setting.MT && !(pos[x][yy].piece_num() === 7 && pos[x][yy].turn() !== turn)){\r\n        break;\r\n      }\r\n      yy = (turn ? yy + dy : yy - dy);\r\n    }\r\n    return;\r\n  }\r\n  // 飛と角は手番で動きが変わらない！（対称）\r\n  // 角\r\n  if(num === 1 || num === 9){\r\n    let dx: number[] = new Array<number>(-1, 1, 1, -1);\r\n    let dy: number[] = new Array<number>(-1, -1, 1, 1);\r\n    for(let i = 0; i < dx.length; ++i){\r\n      let xx = x + dx[i];\r\n      let yy = y + dy[i];\r\n      while(0 <= xx && xx < Setting.LENGTH && 0 <= yy && yy < Setting.LENGTH){\r\n        ++control_pos[xx][yy];\r\n        // 王手をしているか\r\n        if(xx === kingx && yy === kingy){\r\n          control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n          control_pos[Setting.LENGTH][1] = num;\r\n        }\r\n        // 空きマスでなければ終わり\r\n        // ただし相手玉なら終わらない\r\n        if(pos[xx][yy].piece_num() !== Setting.MT && !(pos[xx][yy].piece_num() === 7 && pos[xx][yy].turn() !== turn)){\r\n          break;\r\n        }\r\n        xx += dx[i];\r\n        yy += dy[i];\r\n      }\r\n    }\r\n    // 馬の場合は上下左右も\r\n    if(num === 9){\r\n      dx = new Array<number>(0, 1, 0, -1);\r\n      dy = new Array<number>(-1, 0, 1, 0);\r\n      for(let i = 0; i< dx.length; ++i){\r\n        let xx = x + dx[i];\r\n        let yy = y + dy[i];\r\n        if(0 <= xx && xx < Setting.LENGTH && 0 <= yy && yy < Setting.LENGTH){\r\n          ++control_pos[xx][yy];\r\n          // 王手をしているか\r\n          if(xx === kingx && yy === kingy){\r\n            control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n            control_pos[Setting.LENGTH][1] = num;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return;\r\n  }\r\n  // 飛\r\n  if(num === 0 || num === 8){\r\n    let dx: number[] = new Array<number>(0, 1, 0, -1);\r\n    let dy: number[] = new Array<number>(-1, 0, 1, 0);\r\n    for(let i = 0; i < dx.length; ++i){\r\n      let xx = x + dx[i];\r\n      let yy = y + dy[i];\r\n      while(0 <= xx && xx < Setting.LENGTH && 0 <= yy && yy < Setting.LENGTH){\r\n        ++control_pos[xx][yy];\r\n        // 王手をしているか\r\n        if(xx === kingx && yy === kingy){\r\n          control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n          control_pos[Setting.LENGTH][1] = num;\r\n        }\r\n        // 空きマスでなければ終わり\r\n        // ただし相手玉なら終わらない\r\n        if(pos[xx][yy].piece_num() !== Setting.MT && !(pos[xx][yy].piece_num() === 7 && pos[xx][yy].turn() !== turn)){\r\n          break;\r\n        }\r\n        xx += dx[i];\r\n        yy += dy[i];\r\n      }\r\n    }\r\n    // 竜の場合は斜めも\r\n    if(num === 8){\r\n      dx = new Array<number>(-1, 1, 1, -1);\r\n      dy = new Array<number>(-1, -1, 1, 1);\r\n      for(let i = 0; i< dx.length; ++i){\r\n        let xx = x + dx[i];\r\n        let yy = y + dy[i];\r\n        if(0 <= xx && xx < Setting.LENGTH && 0 <= yy && yy < Setting.LENGTH){\r\n          ++control_pos[xx][yy];\r\n          // 王手をしているか\r\n          if(xx === kingx && yy === kingy){\r\n            control_pos[Setting.LENGTH][0] = x * Setting.LENGTH + y;\r\n            control_pos[Setting.LENGTH][1] = num;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return;\r\n  }\r\n}\r\n\r\n// 駒の利きを列挙\r\n// 一つの駒を指定することもできる\r\n// ついでに王手をかけている駒の位置も返す\r\nfunction control_pos(pos: Piece[][], turn: boolean, x: number = -1, y: number = -1, kingx: number = -1, kingy: number = -1, check_king: boolean = true): number[][]{\r\n  let control_pos: number[][] = [];\r\n  for(let i = 0; i < Setting.LENGTH + 1; ++i){\r\n    control_pos[i] = new Array<number>(Setting.LENGTH).fill(0);\r\n  }\r\n  if(x !== -1){\r\n    control_pos_sub(control_pos, pos, turn, x, y);\r\n    return control_pos;\r\n  }\r\n  for(let i = 0; i < Setting.LENGTH; ++i){\r\n    for(let j = 0; j < Setting.LENGTH; ++j){\r\n      if(pos[i][j].piece_num() !== Setting.MT && pos[i][j].turn() === turn){\r\n        control_pos_sub(control_pos, pos, turn, i, j, kingx, kingy, check_king);\r\n      }\r\n    }\r\n  }\r\n  return control_pos;\r\n}\r\n\r\n// 王手がかかっているか\r\n// 返り値：（1桁目：王手をかけている駒の数、2桁目：そのうち防げる駒の数）\r\nfunction check(pos: Piece[][], captured: number[], turn: boolean, x: number = -1, y : number = -1): number{\r\n  // 玉の位置\r\n  if(x === -1){\r\n    for(let i = 0; i < Setting.LENGTH; ++i){\r\n      for(let j = 0; j < Setting.LENGTH; ++j){\r\n        if(pos[i][j].piece_num() === 7 && pos[i][j].turn() === turn){\r\n          x = i;\r\n          y = j;\r\n          i = Setting.LENGTH;\r\n          j = Setting.LENGTH;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // 効いているマスをあらかじめ求めておく\r\n  let def_controls: number[][] = control_pos(pos, turn, -1, -1, -1, -1, false);\r\n  let atc_controls: number[][] = control_pos(pos, !turn, -1, -1, x, y);\r\n  // 王手をかけている駒の数\r\n  let cnt: number = atc_controls[x][y];\r\n  if(cnt === 0){\r\n    return 0;\r\n  }\r\n  // 2つ以上の駒が王手をかけているなら逃げるしかないのでreturn\r\n  if(cnt > 1){\r\n    return cnt * 10;\r\n  }\r\n  // 王手をかけている駒を（玉以外で）取れるか\r\n  // 玉で取れる場合はここではチェックしなくてよい\r\n  let atc: number = atc_controls[Setting.LENGTH][0];\r\n  let atcx: number = Math.floor(atc / Setting.LENGTH);\r\n  let atcy: number = atc % Setting.LENGTH;\r\n  // 桂馬以外の飛び道具で王手されているとき合い駒できるか\r\n  let num: number = atc_controls[Setting.LENGTH][1];\r\n  if(num === 0 || num === 1 || num === 5 || num === 8 || num === 9){\r\n    let dx: number = atcx - x;\r\n    let dy: number = atcy - y;\r\n    if(dx !== 0){\r\n      dx /= Math.abs(dx);\r\n    }\r\n    if(dy !== 0){\r\n      dy /= Math.abs(dy);\r\n    }\r\n    let xx: number = x + dx;\r\n    let yy: number = y + dy;\r\n    while(xx !== atcx || yy !== atcy){\r\n      // 移動合いできるか\r\n      if(def_controls[xx][yy] > 0){\r\n        return 11;\r\n      }\r\n      // 持ち駒で合い駒できるか\r\n      for(let i = 0; i < Setting.WHITE; ++i){\r\n        if(captured[i] === 0){\r\n          continue;\r\n        }\r\n        let cur_pos: Piece[][] = _.cloneDeep(pos);\r\n        cur_pos[xx][yy] = set_piece(i, turn);\r\n        if(can_move(pos, cur_pos, captured, -1, -1, x, yy, !turn)){\r\n          // 二歩かどうかはチェックする必要がある\r\n          if(i === 6 && nifu(cur_pos, xx, turn)){\r\n            continue;\r\n          }\r\n          return 11;\r\n        }\r\n      }\r\n      xx += dx;\r\n      yy += dy;\r\n    }\r\n  }\r\n\r\n  return 10;\r\n}\r\n\r\n// 詰んでいるか\r\nfunction mate(pos: Piece[][], captured: number[], turn: boolean): boolean{\r\n  // 玉の位置\r\n  let x: number = -1;\r\n  let y: number = -1;\r\n  for(let i = 0; i < Setting.LENGTH; ++i){\r\n    for(let j = 0; j < Setting.LENGTH; ++j){\r\n      if(pos[i][j].piece_num() === 7 && pos[i][j].turn() === turn){\r\n        x = i;\r\n        y = j;\r\n        i = Setting.LENGTH;\r\n        j = Setting.LENGTH;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  // 王手をかけている駒の数\r\n  let cnt: number = check(pos, captured, turn, x, y);\r\n  // 王手されていなければ明らかに詰んでいない\r\n  if(cnt === 0){\r\n    return false;\r\n  }\r\n  // 今いるマス及び周りのマスで王手がかかるか\r\n  let atc_controls: number[][] = control_pos(pos, !turn);\r\n  let dx: number[] = new Array<number>(1, 1, 0, -1, -1, -1, 0, 1);\r\n  let dy: number[] = new Array<number>(0, 1, 1, 1, 0, -1, -1, -1);\r\n  for(let i = 0; i < dx.length; ++i){\r\n    let xx = x + dx[i];\r\n    let yy = y + dy[i];\r\n    if(xx < 0 || Setting.LENGTH <= xx || yy < 0 || Setting.LENGTH <= yy){\r\n      continue;\r\n    }\r\n    // 自分の駒があるとダメ\r\n    if(pos[xx][yy].piece_num() !== Setting.MT && pos[xx][yy].turn() === turn){\r\n      continue;\r\n    }\r\n    // 逃げられるマスがあれば詰んでいない\r\n    if(atc_controls[xx][yy] === 0){\r\n      return false;\r\n    }\r\n  }\r\n  // 2つ以上の駒から王手されている場合は明らかにダメ\r\n  if(Math.floor(cnt / 10) > 1){\r\n    return true;\r\n  }\r\n  // 防げる王手か\r\n  return cnt % 10 < 1;\r\n}\r\n\r\n// 動けるマスか\r\n// 動かす前の盤面、動かした後の盤面、移動前の位置、移動後の位置、手番\r\nfunction can_move(bfr_pos: Piece[][], cur_pos: Piece[][], captured: number[], xx: number, yy: number, x: number, y: number, turn: boolean): boolean{\r\n  let num: number = cur_pos[x][y].piece_num();\r\n  // 駒を打つときは行き所がないかと、打ち歩詰めのみをチェックすればよい\r\n  // 二歩のチェックはここではせずに反則負けにする\r\n  if(xx === -1){\r\n    if(num === 4){\r\n      return (turn ? y > 1 : y < Setting.LENGTH - 1 - 1);\r\n    }\r\n    if(num === 5){\r\n      return (turn ? y !== 0 : y !== Setting.LENGTH - 1);\r\n    }\r\n    if(num === 6){\r\n      if((turn ? y === 0 : y === Setting.LENGTH - 1)){\r\n        return false;\r\n      }\r\n      // 打ち歩詰めかどうか\r\n      return !mate(cur_pos, captured, !turn);\r\n    }\r\n    return true;\r\n  }\r\n  // ルール通りの動きか調べる\r\n  // 香、角、飛は駒をすり抜けに注意\r\n  let controls: number[][] = control_pos(bfr_pos, turn, xx, yy);\r\n  return controls[x][y] > 0;\r\n}\r\n\r\n// 二歩かどうか\r\n// 打った筋だけ見ればよい\r\nfunction nifu(pos: Piece[][], x: number, turn: boolean): boolean{\r\n  let cnt = 0;\r\n  for(let i = 0; i < Setting.LENGTH; ++i){\r\n    if(pos[x][i].piece_num() === 6 && pos[x][i].turn() === turn){\r\n      ++cnt;\r\n    }\r\n  }\r\n  return cnt >= 2;\r\n}\r\n\r\ninterface IGameProps {\r\n  start_pos: Piece[][];\r\n  start_black_piece: number[];\r\n  start_white_piece: number[];\r\n  current_pos: Piece[][];\r\n  current_black_piece: number[];\r\n  current_white_piece: number[];\r\n  control_piece: boolean[][];\r\n  kifu: Array<string>;\r\n  turn: boolean;\r\n  moves: number;\r\n  moves_sub: number;\r\n  clicked_piece: number;\r\n  final_piece: number;\r\n  black_name: string;\r\n  white_name: string;\r\n  is_black: boolean;\r\n  moved_piece: number;\r\n  promotion: boolean;\r\n  resign: boolean;\r\n  result: boolean;\r\n}\r\n\r\ninterface IGameState {\r\n  // 開始局面\r\n  start_pos: Piece[][];\r\n  start_black_piece: number[];\r\n  start_white_piece: number[];\r\n  // 現局面\r\n  current_pos: Piece[][];\r\n  current_black_piece: number[];\r\n  current_white_piece: number[];\r\n  // 指し手の候補\r\n  control_piece: boolean[][];\r\n  // 棋譜\r\n  kifu: Array<string>;\r\n  // 先手番かどうか\r\n  turn: boolean;\r\n  // 手数\r\n  moves: number;\r\n  // 表示用の手数\r\n  moves_sub: number;\r\n  // 掴んでいる駒\r\n  clicked_piece: number;\r\n  // 最後に動かした駒\r\n  final_piece: number;\r\n  // 先手の名前\r\n  black_name: string;\r\n  // 後手の名前\r\n  white_name: string;\r\n  // 自分が先手かどうか\r\n  is_black: boolean;\r\n  // 駒を成るときに使う移動先\r\n  moved_piece: number;\r\n  promotion: boolean;\r\n  // 投了メッセージを表示するか\r\n  resign: boolean;\r\n  // 結果メッセージ\r\n  result: boolean;\r\n}\r\n\r\nexport class Game extends React.Component<IGameProps, IGameState> {\r\n  constructor(props: IGameProps){\r\n    super(props);\r\n    this.state = {\r\n      start_pos: this.props.start_pos,\r\n      start_black_piece: this.props.start_black_piece,\r\n      start_white_piece: this.props.start_white_piece,\r\n      current_pos: this.props.current_pos,\r\n      current_black_piece: this.props.current_black_piece,\r\n      current_white_piece: this.props.current_white_piece,\r\n      control_piece: this.props.control_piece,\r\n      kifu: this.props.kifu,\r\n      turn: this.props.turn,\r\n      moves: this.props.moves,\r\n      moves_sub: this.props.moves_sub,\r\n      clicked_piece: this.props.clicked_piece,\r\n      final_piece: this.props.final_piece,\r\n      black_name: this.props.black_name,\r\n      white_name: this.props.white_name,\r\n      is_black: this.props.is_black,\r\n      moved_piece: this.props.moves,\r\n      promotion: this.props.promotion,\r\n      resign: this.props.resign,\r\n      result: this.props.result,\r\n    };\r\n    this.handlePromotion = this.handlePromotion.bind(this);\r\n    this.handleResign= this.handleResign.bind(this);\r\n    this.handleResultClose = this.handleResultClose.bind(this);\r\n  }\r\n\r\n  handleClick(i: number){\r\n    if(this.state.moves < 0){\r\n      return;\r\n    }\r\n    let clicked_piece: number = this.state.clicked_piece;\r\n    const turn = this.state.turn;\r\n    let tmp_pos = _.cloneDeep(this.state.current_pos);  // 動かした後の盤面\r\n    const current_black_piece = _.cloneDeep(this.state.current_black_piece);\r\n    const current_white_piece = _.cloneDeep(this.state.current_white_piece);\r\n    // 持ち駒をクリックしたとき\r\n    if(i < Setting.WHITE * 2){\r\n      if(clicked_piece === Setting.UNCLICKED){\r\n        if((turn ? (i < Setting.WHITE && current_black_piece[i] > 0) : (i >= Setting.WHITE && current_white_piece[i - Setting.WHITE] > 0))){\r\n          // 候補の列挙\r\n          // 駒を打つときは王手がかかっていないかと、行き所がないか、二歩、打ち歩詰めをチェックする\r\n          let tmp_control_piece = set_control_piece(true);\r\n          let num = (i >= Setting.WHITE ? i - Setting.WHITE : i);\r\n          for(let x = 0; x < Setting.LENGTH; ++x){\r\n            for(let y = 0; y < Setting.LENGTH; ++y){\r\n              // 駒がある場所は置けない\r\n              if(tmp_pos[x][y].piece_num() !== Setting.MT){\r\n                tmp_control_piece[x][y] = false;\r\n              }\r\n              else if(num === 4){\r\n                tmp_control_piece[x][y] = (turn ? y > 1 : y < Setting.LENGTH - 1 - 1);\r\n              }\r\n              else if(num === 5){\r\n                tmp_control_piece[x][y] = (turn ? y !== 0 : y !== Setting.LENGTH - 1);\r\n              }\r\n              else if(num === 6){\r\n                tmp_control_piece[x][y] = (turn ? y !== 0 : y !== Setting.LENGTH - 1);\r\n                tmp_pos[x][y] = set_piece(num, turn);\r\n                if(nifu(tmp_pos, x, turn)){\r\n                  tmp_control_piece[x][y] = false;\r\n                }\r\n                // 打ち歩詰めかどうか\r\n                // 前に敵玉がいるときだけチェックすればよい\r\n                if((turn ? (y > 1 && tmp_pos[x][y - 1].piece_num() === 7 && tmp_pos[x][y - 1].turn() !== turn) : (y < Setting.LENGTH - 1 && tmp_pos[x][y + 1].piece_num() === 7 && tmp_pos[x][y + 1].turn() !== turn))){\r\n                  if(mate(tmp_pos, (turn ? current_white_piece : current_black_piece), !turn)){\r\n                    tmp_control_piece[x][y] = false;\r\n                  }\r\n                }\r\n                // 盤面を戻す\r\n                tmp_pos[x][y] = new Mt();\r\n              }\r\n              if(tmp_control_piece[x][y]){\r\n                tmp_pos[x][y] = set_piece(num, turn);\r\n                tmp_control_piece[x][y] = !check(tmp_pos, (turn ? current_white_piece : current_black_piece), turn);\r\n                tmp_pos[x][y] = new Mt();\r\n              }\r\n            }\r\n          }\r\n          this.setState({\r\n            control_piece: tmp_control_piece,\r\n            clicked_piece: i,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      this.setState({\r\n        clicked_piece: Setting.UNCLICKED,\r\n        control_piece: set_control_piece(),\r\n      });\r\n      return;\r\n    }\r\n\r\n    // 持ち駒の分を引く\r\n    let x: number = Math.floor((i - Setting.WHITE * 2) / Setting.LENGTH);\r\n    let y: number = (i - Setting.WHITE * 2) % Setting.LENGTH;\r\n    const current_pos = this.state.current_pos.concat();\r\n    // 駒を掴んでないとき\r\n    if(this.state.clicked_piece === Setting.UNCLICKED){\r\n      // 手番の駒以外はダメ\r\n      if(current_pos[x][y].piece_num() === Setting.MT || current_pos[x][y].turn() !== turn){\r\n        return;\r\n      }\r\n      // 候補の列挙\r\n      // 王手がかかっていないかのみをチャックすればよい\r\n      // 駒を成らないので候補に行き所がない駒が含まれることもあるが、チェックする必要はない\r\n      // これは適切な移動ならば行き所のない駒はできないため\r\n      let tmp_control_pos = control_pos(current_pos, turn, x, y, -1, -1, false);\r\n      let tmp_control_piece = set_control_piece(false);\r\n      for(let xx = 0; xx < Setting.LENGTH; ++xx){\r\n        for(let yy = 0; yy < Setting.LENGTH; ++yy){\r\n          if(tmp_control_pos[xx][yy] === 0){\r\n            continue;\r\n          }\r\n          // 手番の駒はダメ\r\n          if(current_pos[xx][yy].piece_num() !== Setting.MT && current_pos[xx][yy].turn() === turn){\r\n            continue;\r\n          }\r\n          let piece = tmp_pos[xx][yy];\r\n          tmp_pos[xx][yy] = tmp_pos[x][y];\r\n          tmp_pos[x][y] = new Mt();\r\n          tmp_control_piece[xx][yy] = (check(tmp_pos, (turn ? current_black_piece : current_white_piece), turn) === 0);\r\n          tmp_pos[x][y] = tmp_pos[xx][yy];\r\n          tmp_pos[xx][yy] = piece;\r\n        }\r\n      }\r\n      this.setState({\r\n        control_piece: tmp_control_piece,\r\n        clicked_piece: i,\r\n      });\r\n      return;\r\n    }\r\n\r\n    // ここでは必ず盤面をクリックしている\r\n    let current_control_piece = this.state.control_piece;\r\n    // 候補になかったらダメ\r\n    if(!current_control_piece[x][y]){\r\n      this.setState({\r\n        control_piece: set_control_piece(),\r\n        clicked_piece: Setting.UNCLICKED,\r\n      });\r\n      return;\r\n    }\r\n\r\n    // 以下では正しい指し手であることが保証されている\r\n    const moves = this.state.moves;\r\n    let tmp_black_piece = _.cloneDeep(current_black_piece);\r\n    let tmp_white_piece = _.cloneDeep(current_white_piece);\r\n    let xx: number = -1;\r\n    let yy: number = -1;\r\n    // 持ち駒を掴んでいるとき\r\n    if(clicked_piece < Setting.WHITE * 2){\r\n      // 先手の駒を掴んでいる場合\r\n      // 掴むときに手番かチェックしているので、ここではチェックしなくてよい\r\n      if(turn){\r\n        // 持ち駒の更新\r\n        --tmp_black_piece[clicked_piece];\r\n         // 盤面の更新\r\n        tmp_pos[x][y] = set_piece(clicked_piece, turn);\r\n      }\r\n      else{\r\n        // 持ち駒の更新\r\n        --tmp_white_piece[clicked_piece - Setting.WHITE];\r\n         // 盤面の更新\r\n        tmp_pos[x][y] = set_piece(clicked_piece - Setting.WHITE, turn);\r\n      }\r\n    }\r\n    else{\r\n      // 持ち駒の分を引く\r\n      xx = Math.floor((clicked_piece - Setting.WHITE * 2) / Setting.LENGTH);\r\n      yy = (clicked_piece- Setting.WHITE * 2) % Setting.LENGTH;\r\n      let piece = tmp_pos[x][y];\r\n      // 盤面の更新\r\n      tmp_pos[x][y] = tmp_pos[xx][yy];\r\n      tmp_pos[xx][yy] = new Mt();\r\n      // 持ち駒の更新\r\n      let num: number = piece.piece_num();\r\n      if(num !== Setting.MT){\r\n        // 成っている駒を生に戻す\r\n        if(num > Setting.WHITE){\r\n          num -= Setting.MT / 2;\r\n        }\r\n        turn ? ++tmp_black_piece[num] : ++tmp_white_piece[num];\r\n      }\r\n    }\r\n\r\n    // 成れるときは聞く\r\n    // 条件：盤面から3段目に移動または3段目から移動するときで、金と玉以外の成っていない駒のとき\r\n    let num: number = tmp_pos[x][y].piece_num();\r\n    if(xx !== -1 && (turn ? (y < 3 || yy < 3) : (y > Setting.LENGTH - 1 - 3 || yy > Setting.LENGTH - 1 - 3)) && num < Setting.WHITE && Setting.PIECES[num + Setting.MT / 2] !== \"\"){\r\n      let is_promoted: Boolean = false;\r\n      // 必ず成るときは聞かずに成る\r\n      // 歩、香の1段目、桂の1,2段目\r\n      if(5 <= num && num <= 6){\r\n        if((turn ? y === 0 : y === Setting.LENGTH - 1)){\r\n          tmp_pos[x][y].promote();\r\n          is_promoted = true;\r\n        }\r\n      }\r\n      else if(num === 4){\r\n        if((turn ? y < 2 : y > Setting.LENGTH - 1 - 2)){\r\n          tmp_pos[x][y].promote();\r\n          is_promoted = true;\r\n        }\r\n      }\r\n      if(!is_promoted){\r\n        this.setState({\r\n          moved_piece: i,\r\n          promotion: true,\r\n        });\r\n        return;\r\n      }\r\n    }\r\n    this.setState({\r\n      current_pos: tmp_pos,\r\n      current_black_piece: tmp_black_piece,\r\n      current_white_piece: tmp_white_piece,\r\n      control_piece: set_control_piece(),\r\n      turn: !turn,\r\n      moves: moves + 1,\r\n      moves_sub: moves + 1,\r\n      clicked_piece: Setting.UNCLICKED,\r\n      final_piece: i,\r\n    });\r\n    // 詰んでいたら対局終了\r\n    if(mate(tmp_pos, (turn ? tmp_white_piece : tmp_black_piece), !turn)){\r\n      setTimeout(() => {\r\n        alert(`まで${(moves + 1)}手にて${(turn ? this.state.black_name : this.state.white_name)}の勝ちです！`);\r\n      }, 200);\r\n      this.setState({\r\n        moves: -1,\r\n      });\r\n      return;\r\n    }\r\n  }\r\n\r\n  resign(){\r\n    const moves: number = this.state.moves;\r\n    if(moves < 0){\r\n      return;\r\n    }\r\n    this.setState({\r\n      resign: true,\r\n    });\r\n  }\r\n\r\n  rotate(){\r\n    this.setState({\r\n      is_black: !this.state.is_black,\r\n      clicked_piece: Setting.UNCLICKED,\r\n      control_piece: set_control_piece(),\r\n    });\r\n    return;\r\n  }\r\n\r\n  handlePromotion(is_promoted: boolean){\r\n    // 正しい動きであることは保証されている\r\n    let clicked_piece: number = this.state.clicked_piece;\r\n    const turn = this.state.turn;\r\n    let tmp_pos = _.cloneDeep(this.state.current_pos);  // 動かした後の盤面\r\n    const current_black_piece = _.cloneDeep(this.state.current_black_piece);\r\n    const current_white_piece = _.cloneDeep(this.state.current_white_piece);\r\n    const moves = this.state.moves;\r\n    let tmp_black_piece = _.cloneDeep(current_black_piece);\r\n    let tmp_white_piece = _.cloneDeep(current_white_piece);\r\n    let xx: number = -1;\r\n    let yy: number = -1;\r\n    let i = this.state.moved_piece;\r\n    let x: number = Math.floor((i - Setting.WHITE * 2) / Setting.LENGTH);\r\n    let y: number = (i - Setting.WHITE * 2) % Setting.LENGTH;\r\n    // 持ち駒を掴んでいるとき\r\n    if(clicked_piece < Setting.WHITE * 2){\r\n      // 先手の駒を掴んでいる場合\r\n      if(turn){\r\n        // 持ち駒の更新\r\n        --tmp_black_piece[clicked_piece];\r\n         // 盤面の更新\r\n        tmp_pos[x][y] = set_piece(clicked_piece, turn);\r\n      }\r\n      else{\r\n        // 持ち駒の更新\r\n        --tmp_white_piece[clicked_piece - Setting.WHITE];\r\n         // 盤面の更新\r\n        tmp_pos[x][y] = set_piece(clicked_piece - Setting.WHITE, turn);\r\n      }\r\n    }\r\n    else{\r\n      // 持ち駒の分を引く\r\n      xx = Math.floor((clicked_piece - Setting.WHITE * 2) / Setting.LENGTH);\r\n      yy = (clicked_piece- Setting.WHITE * 2) % Setting.LENGTH;\r\n      let piece = tmp_pos[x][y];\r\n      // 盤面の更新\r\n      tmp_pos[x][y] = tmp_pos[xx][yy];\r\n      tmp_pos[xx][yy] = new Mt();\r\n      // 持ち駒の更新\r\n      let num: number = piece.piece_num();\r\n      if(num !== Setting.MT){\r\n        // 成っている駒を生に戻す\r\n        if(num > Setting.WHITE){\r\n          num -= Setting.MT / 2;\r\n        }\r\n        turn ? ++tmp_black_piece[num] : ++tmp_white_piece[num];\r\n      }\r\n    }\r\n    if(is_promoted){\r\n      tmp_pos[x][y].promote();\r\n    }\r\n    this.setState({\r\n      current_pos: tmp_pos,\r\n      current_black_piece: tmp_black_piece,\r\n      current_white_piece: tmp_white_piece,\r\n      control_piece: set_control_piece(),\r\n      turn: !turn,\r\n      moves: moves + 1,\r\n      moves_sub: moves + 1,\r\n      clicked_piece: Setting.UNCLICKED,\r\n      final_piece: i,\r\n      moved_piece: Setting.UNCLICKED,\r\n      promotion: false,\r\n    });\r\n    // 詰んでいたら対局終了\r\n    if(mate(tmp_pos, (turn ? tmp_white_piece : tmp_black_piece), !turn)){\r\n      setTimeout(() => {\r\n        this.setState({\r\n          result: true,\r\n        });\r\n      }, 200);\r\n      this.setState({\r\n        moves: -1,\r\n        moves_sub: moves+1,\r\n      });\r\n      return;\r\n    }\r\n  }\r\n\r\n  handleResign(resign: boolean){\r\n    if(resign){\r\n      setTimeout(() => {\r\n        this.setState({\r\n          result: true,\r\n        });\r\n      }, 200);\r\n      this.setState({\r\n        moves: -1,\r\n        clicked_piece: Setting.UNCLICKED,\r\n        control_piece: set_control_piece(),\r\n        resign: false,\r\n      });\r\n    }\r\n    else{\r\n      this.setState({\r\n        resign: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  handleResultClose(){\r\n    this.setState({\r\n      result: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    let game: string = \"game-info\";\r\n    if(!this.state.is_black){\r\n      game += \" white\";\r\n    }\r\n    const moves = this.state.moves_sub;\r\n    const legend = (this.state.is_black ? `△${this.state.white_name}　${moves}手目　▲${this.state.black_name}` : `▲${this.state.black_name}　${moves}手目　△${this.state.white_name}`)\r\n    return (\r\n      <div className=\"game-info\">\r\n        <div className=\"game\">\r\n          <div className=\"center bold\">\r\n            {legend}\r\n          </div>\r\n          <div className={game}>\r\n            <div className=\"game-info-white white\">\r\n              <div>{\"△\"}</div>\r\n              <Captured\r\n                squares={this.state.current_white_piece}\r\n                clicked_piece={this.state.clicked_piece}\r\n                is_black={false}\r\n                turn={this.state.turn}\r\n                onClick={i => this.handleClick(i)}\r\n              />\r\n            </div>\r\n            <div className=\"game-board\">\r\n              <Board\r\n                squares={this.state.current_pos}\r\n                onClick={i => this.handleClick(i)}\r\n                clicked_piece={this.state.clicked_piece}\r\n                control_piece={this.state.control_piece}\r\n                final_piece={this.state.final_piece}\r\n              />\r\n            </div>\r\n            <div className=\"game-info-black\">\r\n              <div>{\"▲\"}</div>\r\n              <Captured\r\n                squares={this.state.current_black_piece}\r\n                clicked_piece={this.state.clicked_piece}\r\n                is_black={true}\r\n                turn={this.state.turn}\r\n                onClick={i => this.handleClick(i)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <Button className={\"status\"} variant=\"contained\" color=\"primary\" onClick={() => this.rotate()} >\r\n          反転\r\n        </Button>\r\n        &nbsp;\r\n        <Button className={\"status\"} variant=\"contained\" color=\"secondary\" onClick={() => this.resign()}>\r\n          投了\r\n        </Button>\r\n        <Confirm\r\n          title={\"成りますか？\"}\r\n          message={\"\"}\r\n          open={this.state.promotion}\r\n          handleYes={() => this.handlePromotion(true)}\r\n          handleNo={() => this.handlePromotion(false)}\r\n        />\r\n        <Confirm\r\n          title={\"投了しますか？\"}\r\n          message={\"\"}\r\n          open={this.state.resign}\r\n          handleYes={() => this.handleResign(true)}\r\n          handleNo={() => this.handleResign(false)}\r\n        />\r\n        <Alert\r\n          title={`まで${moves}手にて${(this.state.turn ? this.state.white_name : this.state.black_name)}の勝ちです！`}\r\n          message={\"\"}\r\n          open={this.state.result}\r\n          handleClose={this.handleResultClose}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport {Setting} from \"./setting\";\r\nimport {Game, make_board, set_kifu, set_pieces, set_control_piece} from './game';\r\n\r\nReactDOM.render(\r\n  <Game\r\n    start_pos={make_board()}\r\n    start_black_piece={set_pieces()}\r\n    start_white_piece={set_pieces()}\r\n    current_pos={make_board()}\r\n    current_black_piece={set_pieces()}\r\n    current_white_piece={set_pieces()}\r\n    control_piece={set_control_piece()}\r\n    kifu={set_kifu()}\r\n    turn={true}\r\n    moves={0}\r\n    moves_sub={0}\r\n    clicked_piece={Setting.UNCLICKED}\r\n    final_piece={Setting.UNCLICKED}\r\n    black_name={\"先手\"}\r\n    white_name={\"後手\"}\r\n    is_black={true}\r\n    moved_piece={Setting.UNCLICKED}\r\n    promotion={false}\r\n    resign={false}\r\n    result={false}\r\n  />,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}